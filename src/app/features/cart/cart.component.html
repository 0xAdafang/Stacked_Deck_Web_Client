<app-header></app-header>

<div class="cart-wrapper" [class.dark-theme]="isDark" [class.light-theme]="!isDark">
  <div class="container">
    <h1 class="page-title">Your Cart</h1>

    <div *ngIf="loading" class="loading-state"><div class="spinner"></div></div>

    <!-- Empty State -->
    <div *ngIf="!loading && activeItems.length === 0 && savedItems.length === 0" class="empty-cart">
      <p>Your cart is empty.</p>
      <button class="btn-primary" routerLink="/products">Start Shopping</button>
    </div>

    <div class="cart-grid" *ngIf="!loading && (activeItems.length > 0 || savedItems.length > 0)">

      <!-- LEFT: Items List -->
      <div class="cart-items-section">

        <!-- Active Items -->
        <div class="item-list" *ngIf="activeItems.length > 0">
          <div *ngFor="let item of activeItems" class="cart-item">
            <div class="item-image" [routerLink]="['/products', item.product.slug]">
              <img [src]="item.product.image" [alt]="item.product.name">
            </div>
            <div class="item-details">
              <div class="item-header">
                <h3>{{ item.product.name }}</h3>
                <span class="price">${{ (item.product.price / 100).toFixed(2) }}</span>
              </div>
              <p class="item-meta">{{ item.product.categoryName }} â€¢ {{ item.product.condition || 'New' }}</p>

              <div class="item-actions">
                <div class="qty-control">
                  <button (click)="updateQty(item, -1)">-</button>
                  <span>{{ item.quantity }}</span>
                  <button (click)="updateQty(item, 1)">+</button>
                </div>
                <button class="text-btn" (click)="toggleSave(item)">Save for later</button>
                <button class="text-btn delete" (click)="removeItem(item)">Remove</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Saved For Later -->
        <div class="saved-section" *ngIf="savedItems.length > 0">
          <h2>Saved for Later ({{ savedItems.length }})</h2>
          <div *ngFor="let item of savedItems" class="cart-item saved">
            <div class="item-image">
              <img [src]="item.product.image" [alt]="item.product.name">
            </div>
            <div class="item-details">
              <h3>{{ item.product.name }}</h3>
              <p class="price">${{ (item.product.price / 100).toFixed(2) }}</p>
              <button class="text-btn move-back" (click)="toggleSave(item)">Move to Cart</button>
              <button class="text-btn delete" (click)="removeItem(item)">Remove</button>
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT: Summary -->
      <div class="cart-summary" *ngIf="activeItems.length > 0">
        <h2>Summary</h2>
        <div class="summary-row">
          <span>Subtotal ({{ cart?.totalItems }} items)</span>
          <span>${{ ((cart?.totalAmount || 0) / 100).toFixed(2) }}</span>
        </div>
        <div class="summary-row">
          <span>Shipping</span>
          <span class="free">FREE</span>
        </div>
        <div class="divider"></div>
        <div class="summary-row total">
          <span>Total</span>
          <span>${{ ((cart?.totalAmount || 0) / 100).toFixed(2) }}</span>
        </div>

        <button class="btn-checkout" routerLink="/checkout">Proceed to Checkout</button>

        <div class="secure-badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          Secure Checkout
        </div>
      </div>

    </div>
  </div>
</div>
<app-footer></app-footer>
