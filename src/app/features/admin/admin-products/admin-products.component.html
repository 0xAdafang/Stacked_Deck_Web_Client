<app-header></app-header>
<div class="admin-container" [class.light-theme]="!isDark">
<div class="admin-container">
  <div class="header-actions">
    <h1>Product Management</h1>
    <button *ngIf="!showForm" class="btn-add" (click)="openCreate()">+ New Product</button>
  </div>

  <div class="editor-panel" *ngIf="showForm">
    <h2>{{ isEditing ? 'Edit Product' : 'Create New Product' }}</h2>

    <form [formGroup]="productForm" (ngSubmit)="onSubmit()">

      <div class="row">
        <div class="form-group half">
          <label>SKU</label>
          <input type="text" formControlName="sku">
        </div>
        <div class="form-group half">
          <label>Name</label>
          <input type="text" formControlName="name">
        </div>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea formControlName="description" rows="3"></textarea>
      </div>

      <div class="row">
        <div class="form-group half">
          <label>Price ($)</label>
          <input type="number" formControlName="price" step="0.01">
        </div>
        <div class="form-group half">
          <label>Stock</label>
          <input type="number" formControlName="stockQuantity">
        </div>
      </div>

      <div class="row">
        <div class="form-group half">
          <label>Category</label>
          <select formControlName="categoryId">
            <option value="" disabled>Select Category</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>
        <div class="form-group half">
          <label>Type</label>
          <select formControlName="type">
            <option *ngFor="let t of productTypes" [value]="t.value">{{ t.label }}</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="form-group half">
          <label>Rarity</label>
          <select formControlName="rarity">
            <option [ngValue]="null">-- None --</option>
            <option *ngFor="let r of rarities" [value]="r">{{ r }}</option>
          </select>
        </div>
        <div class="form-group half">
          <label>Condition</label>
          <select formControlName="condition">
            <option [ngValue]="null">-- None --</option>
            <option *ngFor="let c of conditions" [value]="c">{{ c }}</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Image URL</label>
        <input type="text" formControlName="image" placeholder="/assets/cards/...">
      </div>

      <div class="row checkbox-row">
        <div class="form-group checkbox">
          <label><input type="checkbox" formControlName="active"> Active (Visible)</label>
        </div>
        <div class="form-group checkbox">
          <label><input type="checkbox" formControlName="featured"> Featured</label>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="closeForm()">Cancel</button>
        <button type="submit" class="btn-save" [disabled]="productForm.invalid">Save Product</button>
      </div>
    </form>
  </div>

  <div class="table-wrapper" *ngIf="!showForm">
    <table class="admin-table">
      <thead>
      <tr>
        <th>Image</th>
        <th>Info</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let p of products">
        <td><img [src]="p.image" class="thumb" alt=""></td>
        <td>
          <div class="p-name">{{ p.name }}</div>
          <div class="p-sku">{{ p.sku }}</div>
        </td>
        <td class="amount">{{ p.price | currency:'CAD' }}</td>
        <td>
          <span class="badge" [class.low]="p.stockQuantity < 5">{{ p.stockQuantity }}</span>
        </td>
        <td>
          <span class="badge status" [class.active]="p?.active !== false">
            {{ p?.active !== false ? 'Active' : 'Hidden' }}
          </span>
        </td>
        <td class="actions">
          <button class="btn-icon edit" (click)="openEdit(p)">‚úèÔ∏è</button>
          <button class="btn-icon delete" (click)="onDelete(p)">üóëÔ∏è</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<app-footer></app-footer>
