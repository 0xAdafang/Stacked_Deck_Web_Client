<app-header> </app-header>
<div class="admin-page" [class.dark-theme]="isDark">
  <div class="header-section">
    <h1>Inventory Dashboard</h1>
    <button class="btn-create" (click)="openCreate()">
      <span>+</span> New Product
    </button>
  </div>

  <div class="table-container">
    <table class="admin-table">
      <thead>
      <tr>
        <th>Visual</th>
        <th>Product Info</th>
        <th>Category</th>
        <th>Type</th>
        <th>Price</th>
        <th>Stock Status</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let p of products">
        <td>
          <img [src]="p.image" alt="product" class="table-thumb">
        </td>
        <td>
          <div class="name-cell">
            <span>{{ p.name }}</span>
            <div class="featured-badge" *ngIf="p.featured">Featured</div>
            <div style="font-size: 0.75rem; color: #71717a; margin-top: 2px;">{{ p.sku }}</div>
          </div>
        </td>
        <td>{{ p.categoryName || 'â€”' }}</td>
        <td><span class="type-badge">{{ p.type.replace('_', ' ') }}</span></td>
        <td style="font-weight: 700; color: #ef4444;">{{ p.price | currency }}</td>
        <td>
           <span class="badge" [ngStyle]="{'background': p.inStock ? 'rgba(34, 197, 94, 0.2)' : 'rgba(239, 68, 68, 0.2)', 'color': p.inStock ? '#4ade80' : '#f87171', 'border': '1px solid ' + (p.inStock ? 'rgba(34, 197, 94, 0.3)' : 'rgba(239, 68, 68, 0.3)')}">
             {{ p.inStock ? 'In Stock' : 'Out of Stock' }}
           </span>
        </td>
        <td>
          <span class="status-dot" [class.active]="p.active" title="{{ p.active ? 'Visible' : 'Hidden' }}"></span>
        </td>
        <td class="actions-cell">
          <button class="btn-icon edit" (click)="openEdit(p)">Edit</button>
          <button class="btn-icon delete" (click)="onDelete(p)">Del</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="modal-overlay" *ngIf="showForm" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>{{ isEditing ? 'Edit Product' : 'Add New Product' }}</h2>

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <div class="form-group half">
            <label>SKU</label>
            <input type="text" formControlName="sku" [readonly]="isEditing" placeholder="SV03-001">
          </div>
          <div class="form-group half">
            <label>Name</label>
            <input type="text" formControlName="name" placeholder="Charizard ex">
          </div>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea formControlName="description" rows="3" placeholder="Description of the product..."></textarea>
        </div>

        <div class="row">
          <div class="form-group half">
            <label>Price ($)</label>
            <input type="number" formControlName="price" step="0.01" placeholder="0.00">
          </div>
          <div class="form-group half" *ngIf="!isEditing">
            <label>Initial Stock</label>
            <input type="number" formControlName="initialStock" min="0" placeholder="0">
          </div>
          <div class="form-group half">
            <label>Type</label>
            <select formControlName="type">
              <option *ngFor="let t of productTypes" [value]="t.value">{{ t.label }}</option>
            </select>
          </div>
        </div>

        <div class="nested-form-section" formGroupName="cardDetails" *ngIf="productForm.get('type')?.value === 'SINGLE'">
          <h3 class="section-title">Single Card Data</h3>

          <div class="row">
            <div class="form-group half">
              <label>HP</label>
              <input type="text" formControlName="hp" placeholder="330">
            </div>
            <div class="form-group half">
              <label>Types</label>
              <input type="text" formControlName="types" placeholder="Fire">
            </div>
          </div>

          <div class="row">
            <div class="form-group half">
              <label>Stage</label>
              <input type="text" formControlName="stage" placeholder="Stage 2">
            </div>
            <div class="form-group half">
              <label>Weakness</label>
              <input type="text" formControlName="weakness" placeholder="Water x2">
            </div>
          </div>

          <div class="row">
            <div class="form-group half">
              <label>Retreat Cost</label>
              <input type="text" formControlName="retreatCost" placeholder="2">
            </div>
            <div class="form-group half">
              <label>Resistance</label>
              <input type="text" formControlName="resistance" placeholder="Grass -30">
            </div>
          </div>

          <div class="form-group">
            <label>Attacks & Abilities</label>
            <textarea formControlName="attackDetails" rows="3" placeholder="[RC] Wing Attack (60)"></textarea>
          </div>

          <div class="form-group">
            <label>Flavor Text</label>
            <textarea formControlName="flavorText" rows="2" placeholder="Pokedex entry..."></textarea>
          </div>
        </div>
        <div class="row">
          <div class="form-group half">
            <label>Artist / Illustrator</label>
            <input type="text" formControlName="illustrator" placeholder="e.g. Mitsuhiro Arita">
          </div>
        </div>
        <div class="form-group">
          <label>Category (Set)</label>
          <select formControlName="categoryId">
            <option value="" disabled>Select a Set...</option>
            <option *ngFor="let c of categories" [value]="c.id">{{ c.name }} ({{ c.code || 'N/A' }})</option>
          </select>
        </div>

        <div class="form-group">
          <label>Image URL</label>
          <input type="text" formControlName="image" placeholder="https://...">
        </div>

        <div class="row">
          <div class="form-group half">
            <label>Rarity</label>
            <select formControlName="rarity">
              <option [ngValue]="null">Select Rarity...</option>
              <option *ngFor="let r of rarities" [value]="r.value">{{ r.label }}</option>
            </select>
          </div>
          <div class="form-group half">
            <label>Condition</label>
            <select formControlName="condition">
              <option [ngValue]="null">Select Condition...</option>
              <option *ngFor="let c of conditions" [value]="c.value">{{ c.label }}</option>
            </select>
          </div>
        </div>

        <div class="nested-form-section" *ngIf="isEditing" style="border-color: rgba(74, 222, 128, 0.3); background: rgba(74, 222, 128, 0.05);">
          <h3 class="section-title" style="color: #4ade80;">
            ðŸ“¦ Quick Restock
          </h3>

          <div class="row" style="align-items: flex-end;">
            <div class="form-group" style="flex: 2;">
              <label>Add Quantity to Inventory</label>
              <input type="number" #restockInput placeholder="Ex: 10" min="1" style="border-color: rgba(74, 222, 128, 0.5);">
            </div>

            <div class="form-group" style="flex: 1;">
              <button type="button"
                      class="btn-submit"
                      style="background-color: #4ade80; width: 100%; border: none; font-weight: bold; color: #000;"
                      (click)="onRestock(restockInput)">
                + Add Stock
              </button>
            </div>
          </div>

          <p style="font-size: 0.8rem; color: #a1a1aa; margin-top: 5px; font-style: italic;">
            This will instantly update the inventory and generate a movement log.
          </p>
        </div>

        <div class="row toggles">
          <label class="toggle-label">
            <input type="checkbox" formControlName="active">
            <span>Visible</span>
          </label>
          <label class="toggle-label">
            <input type="checkbox" formControlName="featured">
            <span>Featured</span>
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeForm()">Cancel</button>
          <button type="submit" class="btn-submit" [disabled]="productForm.invalid">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
<app-footer></app-footer>
