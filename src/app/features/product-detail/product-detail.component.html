<app-header></app-header>

<div class="main-content">
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading product...</p>
  </div>

  <div class="error-container" *ngIf="error && !loading">
    <p>Product not found or an error occurred.</p>
    <button routerLink="/products">Back to Products</button>
  </div>

  <div class="product-wrapper" *ngIf="!loading && !error && product" [class.dark-theme]="isDark" [class.light-theme]="!isDark">
    <div class="breadcrumb">
      <a routerLink="/">Home</a> &gt;
      <a routerLink="/products">Products</a> &gt;
      <span>{{ product.name }}</span>
    </div>

    <div class="product-layout">
      <div class="product-gallery">
        <div class="main-image">
          <img [src]="selectedImage" [alt]="product.name">
        </div>
        <div class="thumbnail-list" *ngIf="product.images && product.images.length > 0">
          <img *ngFor="let img of product.images" [src]="img" [class.active]="img === selectedImage" (click)="changeImage(img)" alt="thumbnail">
        </div>
      </div>

      <div class="product-info">
        <h5>
          <span *ngIf="product.categoryCode" style="opacity: 0.7; margin-right: 5px;">{{ product.categoryCode }}:</span>
          {{ product.categoryName }}
        </h5>

        <h1>{{ product.name }}</h1>

        <div class="product-meta">
          <span class="meta-badge rarity" [style.background-color]="getRarityColor(product.rarity || '')" *ngIf="product.rarity">
            {{ product.rarity.replace('_', ' ') }}
          </span>
          <span class="meta-badge condition" *ngIf="product.condition">
            {{ getConditionLabel(product.condition) }}
          </span>
        </div>

        <div class="product-price">
          {{ product.price | currency:'USD' }}
        </div>

        <div class="card-specs-container" *ngIf="product.cardDetails && product.type === 'SINGLE'">
          <div class="specs-grid">
            <div class="spec-item" *ngIf="product.cardDetails.hp">
              <span class="label">HP</span>
              <span class="value">{{ product.cardDetails.hp }}</span>
            </div>
            <div class="spec-item" *ngIf="product.cardDetails.types">
              <span class="label">Type</span>
              <span class="value">{{ product.cardDetails.types }}</span>
            </div>
            <div class="spec-item" *ngIf="product.cardDetails.stage">
              <span class="label">Stage</span>
              <span class="value">{{ product.cardDetails.stage }}</span>
            </div>
            <div class="spec-item" *ngIf="product.cardDetails.weakness">
              <span class="label">Weakness</span>
              <span class="value">{{ product.cardDetails.weakness }}</span>
            </div>
            <div class="spec-item" *ngIf="product.cardDetails.retreatCost">
              <span class="label">Retreat</span>
              <span class="value">{{ product.cardDetails.retreatCost }}</span>
            </div>
          </div>
          <div class="flavor-text" *ngIf="product.cardDetails.flavorText">
            "{{ product.cardDetails.flavorText }}"
          </div>
        </div>
        <div class="description">
          <p>{{ product.description }}</p>
        </div>

        <div class="product-actions">
          <div class="quantity-selector" [class.disabled]="!product.inStock">
            <button (click)="updateQuantity(-1)" [disabled]="quantity <= 1">-</button>
            <input type="text" [value]="quantity" readonly>
            <button (click)="updateQuantity(1)" [disabled]="quantity >= maxQuantity">+</button>
          </div>

          <button class="btn-add-cart" (click)="addToCart()" [disabled]="!product.inStock">
            {{ product.inStock ? 'Add to Cart' : 'Out of Stock' }}
          </button>
        </div>

        <p *ngIf="product.inStock && stockStatus?.lowStock" style="color: #eab308; font-size: 0.9rem; margin-top: 10px;">
          Only {{ stockStatus?.quantityAvailable }} left!
        </p>


        <div class="success-message" *ngIf="showSuccessMessage">
          Item added to cart!
        </div>

      </div> </div> </div> </div>
<app-footer></app-footer>
