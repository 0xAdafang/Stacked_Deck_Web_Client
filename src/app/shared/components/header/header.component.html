<div [class.dark-theme]="isDark" [class.light-theme]="!isDark" class="header-wrapper">

  <div class="top-bar">
    <div class="container">
      <div class="promo-text">
      </div>
      <button class="theme-toggle" (click)="toggleTheme()" [attr.aria-label]="isDark ? 'Switch to light mode' : 'Switch to dark mode'">
        <svg *ngIf="isDark" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
        <svg *ngIf="!isDark" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
      </button>
    </div>
  </div>

  <header class="main-header">
    <div class="container">
      <div class="header-content">

        <a routerLink="/" class="logo">
          <span class="logo-primary">STACKED</span>
          <span class="logo-accent">DECK</span>
          <div class="logo-underline"></div>
        </a>

        <div class="search-wrapper desktop-search">
          <input
            type="text"
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
            placeholder="Search for Pokémon cards..."
            class="search-input"
          />
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
        </div>

        <div class="header-actions">

          <button class="action-btn cart-btn" routerLink="/cart" aria-label="View Cart">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            <span *ngIf="cartCount > 0" class="cart-badge">{{ cartCount }}</span>
          </button>

          <div class="user-dropdown-wrapper desktop-only">

            <button *ngIf="!currentUser" class="action-btn account-btn" routerLink="/auth/login" aria-label="Login">
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </button>

            <div *ngIf="currentUser" class="relative">
              <button class="action-btn account-btn" (click)="toggleUserMenu()" [class.active]="userMenuOpen" aria-label="My Account">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </button>

              <div class="user-dropdown" *ngIf="userMenuOpen">
                <div class="dropdown-header">
                  <span class="username">{{ currentUser.username }}</span>
                  <span class="email">{{ currentUser.email }}</span>
                </div>
                <div class="dropdown-divider"></div>
                <ng-container *ngIf="isAdmin">
                  <a routerLink="/admin" (click)="closeUserMenu()" class="dropdown-item" style="color: #ef4444; font-weight: bold;">
                    ⚡ Admin Dashboard
                  </a>
                  <div class="dropdown-divider"></div>
                </ng-container>

                <a routerLink="/account" (click)="closeUserMenu()" class="dropdown-item">My Account</a>
                <a routerLink="/orders" (click)="closeUserMenu()" class="dropdown-item">My Orders</a>
                <div class="dropdown-divider"></div>
                <button (click)="logout()" class="dropdown-item logout">Logout</button>
              </div>
            </div>
          </div>

          <button class="action-btn mobile-menu-btn mobile-only" (click)="toggleMobileMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
          </button>
        </div>
      </div>

      <nav *ngIf="mobileMenuOpen" class="mobile-nav">
        <div class="mobile-auth-section">
          <ng-container *ngIf="!currentUser">
            <a routerLink="/auth/login" class="mobile-nav-link account-link" (click)="toggleMobileMenu()">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              Login / Register
            </a>
          </ng-container>

          <ng-container *ngIf="currentUser">
            <div class="mobile-user-info">
              <span>Signed in as <strong>{{ currentUser.username }}</strong></span>
            </div>
            <a routerLink="/account" class="mobile-nav-link" (click)="toggleMobileMenu()">My Account</a>
            <a routerLink="/orders" class="mobile-nav-link" (click)="toggleMobileMenu()">My Orders</a>
            <button (click)="logout()" class="mobile-nav-link logout-link">Logout</button>
          </ng-container>
        </div>

        <a
          *ngFor="let item of navItems"
          [routerLink]="item.route"
          [queryParams]="item.queryParams"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{exact: item.exact || false}"
          class="mobile-nav-link"
          (click)="toggleMobileMenu()"
        >
          {{ item.label }}
        </a>
      </nav>

      <nav class="desktop-nav">
        <a
          *ngFor="let item of navItems"
          [routerLink]="item.route"
          [queryParams]="item.queryParams"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{exact: item.exact || false}"
          class="nav-link"
        >
          {{ item.label }}
        </a>
      </nav>

      <div class="search-wrapper mobile-search">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
          placeholder="Search cards..."
          class="search-input"
        />
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
      </div>

    </div>
  </header>
</div>
